<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>決鬥者日曆</title>
    <style>
        :root { --blue: #4a90e2; --green: #51cf66; --duel: #fff3bf; }
        body { font-family: sans-serif; background: #f8f9fa; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .calendar-card { background: white; width: 100%; max-width: 400px; border-radius: 15px; padding: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .day-label { text-align: center; font-size: 12px; color: #999; }
        .day { min-height: 65px; border: 1px solid #eee; border-radius: 8px; padding: 4px; position: relative; }
        .day.duel-ready { background-color: var(--duel); border-color: #fcc419; }
        .date-num { font-size: 14px; font-weight: bold; color: #ccc; }
        .status { font-size: 16px; font-weight: 900; line-height: 1.2; text-align: center; margin-top: 2px; }
        .ro { color: var(--blue); }
        .di { color: var(--green); }
        
        .controls { margin-top: 15px; width: 100%; max-width: 400px; display: flex; flex-direction: column; gap: 8px; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        .btn-row { display: flex; gap: 5px; }
        button { flex: 1; padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; background: #eee; }
        .btn-apply { background: #444; color: white; }
        .btn-clear { background: #ff6b6b; color: white; }
    </style>
</head>
<body>

<div class="calendar-card">
    <div class="header">
        <h3 id="monthDisplay" style="margin:0"></h3>
        <div>
            <button onclick="changeMonth(-1)">◀</button>
            <button onclick="changeMonth(1)">▶</button>
        </div>
    </div>
    <div class="grid" id="calendarGrid"></div>
</div>

<div class="controls">
    <input type="text" id="inputR" placeholder="Ro 日期 (如: 1 6-7 13)">
    <input type="text" id="inputD" placeholder="Di 日期 (如: 5 10-12)">
    <div class="btn-row">
        <button class="btn-apply" onclick="batchUpdate()">更新當月標記</button>
        <button class="btn-clear" onclick="clearAll()">清空全部紀錄</button>
    </div>
</div>

<script>
    let currentDate = new Date();
    let checkData = JSON.parse(localStorage.getItem('calendarChecks')) || {};

    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        grid.innerHTML = '';
        ['日', '一', '二', '三', '四', '五', '六'].forEach(w => grid.innerHTML += `<div class="day-label">${w}</div>`);

        const y = currentDate.getFullYear(), m = currentDate.getMonth();
        document.getElementById('monthDisplay').innerText = `${y}年 ${m + 1}月`;

        const firstDay = new Date(y, m, 1).getDay();
        const daysInMonth = new Date(y, m + 1, 0).getDate();

        for (let i = 0; i < firstDay; i++) grid.appendChild(document.createElement('div'));

        for (let d = 1; d <= daysInMonth; d++) {
            const key = `${y}-${m + 1}-${d}`;
            const r = checkData[key + '-R'], d_state = checkData[key + '-D'];
            const dayDiv = document.createElement('div');
            dayDiv.className = `day ${r && d_state ? 'duel-ready' : ''}`;
            dayDiv.innerHTML = `
                <div class="date-num">${d}</div>
                <div class="status">
                    ${r ? '<div class="ro">Ro</div>' : ''}
                    ${d_state ? '<div class="di">Di</div>' : ''}
                </div>`;
            grid.appendChild(dayDiv);
        }
    }

    function batchUpdate() {
        const y = currentDate.getFullYear(), m = currentDate.getMonth() + 1;
        ['R', 'D'].forEach(type => {
            const val = document.getElementById('input' + type).value.trim();
            if (!val) return;
            // 清除當月該類型的舊紀錄（若想疊加可刪除這幾行）
            for(let d=1; d<=31; d++) delete checkData[`${y}-${m}-${d}-${type}`];
            
            val.split(/\s+/).forEach(p => {
                const range = p.split('-').map(Number);
                for (let i = range[0]; i <= (range[1] || range[0]); i++) {
                    checkData[`${y}-${m}-${i}-${type}`] = true;
                }
            });
        });
        save();
    }

    function clearAll() { if(confirm("確定清空？")) { checkData = {}; save(); } }
    function save() { localStorage.setItem('calendarChecks', JSON.stringify(checkData)); renderCalendar(); }
    function changeMonth(n) { currentDate.setMonth(currentDate.getMonth() + n); renderCalendar(); }

    renderCalendar();
</script>
<br>
當月複寫：如果輸入錯了，直接重新輸入正確的數字並按更新即可，不需要手動取消。
<br><br><br>
<a href="index.html">
	<img src="img_0/duelist_clock.jpg" width="300" style="border: 8px solid black;" alt="duel!">
</a>
</body>
</html>
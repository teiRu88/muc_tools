<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„æ±ºé¬¥è€…æ—¥æ›†</title>
    <style>
        :root { --primary: #ff6b6b; --blue: #4a90e2; --green: #51cf66; --bg: #f8f9fa; --duel-day: #fff3bf; --duel-border: #fcc419; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        .calendar-card { background: white; width: 100%; max-width: 500px; border-radius: 15px; padding: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .day-label { text-align: center; font-weight: bold; font-size: 13px; color: #999; padding-bottom: 10px; }
        
        /* åŸºç¤æ ¼å­æ¨£å¼ */
        .day { min-height: 85px; border: 1.5px solid #f0f0f0; border-radius: 10px; padding: 6px; cursor: pointer; background: #fff; position: relative; transition: 0.3s; display: flex; flex-direction: column; }
        .day:hover { border-color: var(--primary); background: #fffafb; }
        
        /* æ±ºé¬¥æ—¥æ¨£å¼ (R+D å‹¾é¸) - è®Šå¾—é–‹å¿ƒä¸”æ¸…æ¥š */
        .day.duel-ready { background-color: var(--duel-day); border-color: var(--duel-border); transform: scale(1.02); z-index: 1; box-shadow: 0 4px 10px rgba(252, 196, 25, 0.2); }
        .day.duel-ready .date-num { color: #856404; font-weight: 800; }
        .day.duel-ready .note { color: #533f03; font-weight: 900; } /* å‚™è¨»è®Šè¶…æ¸…æ¥š */

        .date-num { font-size: 14px; font-weight: 600; color: #444; margin-bottom: 4px; }
        .note { font-size: 10px; color: var(--primary); line-height: 1.2; font-weight: bold; overflow-wrap: break-word; flex-grow: 1; }

        .check-group { display: flex; gap: 4px; margin-top: 4px; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 4px; }
        .check-item { display: flex; align-items: center; font-size: 10px; font-weight: 800; cursor: pointer; }
        .check-item input { margin-right: 2px; width: 12px; height: 12px; }
        .label-r { color: var(--blue); }
        .label-d { color: var(--green); }

        .today { border: 2px dashed var(--primary) !important; }
        nav { margin-top: 20px; text-align: center; }
        nav a { text-decoration: none; color: #666; font-size: 14px; margin: 0 15px; font-weight: bold; }
        button { border: none; background: #eee; padding: 5px 12px; border-radius: 8px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="calendar-card">
    <div class="header">
        <h2 id="monthDisplay">è¼‰å…¥ä¸­...</h2>
        <div style="display: flex; gap: 8px;">
            <button onclick="changeMonth(-1)">â—€</button>
            <button onclick="changeMonth(1)">â–¶</button>
        </div>
    </div>
    <div class="grid" id="calendarGrid"></div>
    <p style="font-size: 11px; color: #bbb; text-align: center; margin-top: 15px;">It's Time to Duel! (R & D å…¨å‹¾é¸è®Šç‚ºé‡‘è‰²æ±ºé¬¥æ—¥)</p>
</div>

<nav>
    <a href="index.html">ğŸ  é¦–é </a>
    <a href="gacha.html">ğŸƒ æŠ½å¡æ©Ÿç‡</a>
    <a href="todo-list.html">ğŸ“ å¾…è¾¦</a>
</nav>

<script>
    let currentDate = new Date();
    let notesData = JSON.parse(localStorage.getItem('calendarNotes')) || {};
    let checkData = JSON.parse(localStorage.getItem('calendarChecks')) || {};

    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        const monthDisplay = document.getElementById('monthDisplay');
        grid.innerHTML = '';

        const weeks = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
        weeks.forEach(w => {
            const div = document.createElement('div');
            div.className = 'day-label';
            div.innerText = w;
            grid.appendChild(div);
        });

        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        monthDisplay.innerText = `${year}å¹´ ${month + 1}æœˆ`;

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const today = new Date();

        for (let i = 0; i < firstDay; i++) {
            grid.appendChild(document.createElement('div'));
        }

        for (let d = 1; d <= daysInMonth; d++) {
            const dateKey = `${year}-${month + 1}-${d}`;
            const dayDiv = document.createElement('div');
            dayDiv.className = 'day';
            
            const isToday = year === today.getFullYear() && month === today.getMonth() && d === today.getDate();
            if(isToday) dayDiv.classList.add('today');

            const savedNote = notesData[dateKey] || "";
            const isR = checkData[dateKey + '-R'] || false;
            const isD = checkData[dateKey + '-D'] || false;

            // åˆ¤æ–·æ˜¯å¦ç‚ºæ±ºé¬¥æ—¥ (R+D çš†å‹¾é¸)
            if (isR && isD) {
                dayDiv.classList.add('duel-ready');
            }

            dayDiv.innerHTML = `
                <div class="date-num" onclick="editNote(event, '${dateKey}')">${d}</div>
                <div class="note" onclick="editNote(event, '${dateKey}')">${savedNote}</div>
                <div class="check-group">
                    <label class="check-item label-r">
                        <input type="checkbox" ${isR ? 'checked' : ''} onchange="toggleCheck(this, '${dateKey}-R')">R
                    </label>
                    <label class="check-item label-d">
                        <input type="checkbox" ${isD ? 'checked' : ''} onchange="toggleCheck(this, '${dateKey}-D')">D
                    </label>
                </div>
            `;
            grid.appendChild(dayDiv);
        }
    }

    function editNote(event, dateKey) {
        event.stopPropagation();
        const currentNote = notesData[dateKey] || "";
        const newNote = prompt(`ç·¨è¼¯å‚™è¨»ï¼š`, currentNote);
        if (newNote !== null) {
            notesData[dateKey] = newNote;
            localStorage.setItem('calendarNotes', JSON.stringify(notesData));
            renderCalendar();
        }
    }

    function toggleCheck(checkbox, checkKey) {
        checkData[checkKey] = checkbox.checked;
        localStorage.setItem('calendarChecks', JSON.stringify(checkData));
        renderCalendar();
    }

    function changeMonth(diff) {
        currentDate.setMonth(currentDate.getMonth() + diff);
        renderCalendar();
    }

    renderCalendar();
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¨˜å¸³æœ¬ v3.17</title>
    <style>
        :root { 
            --primary-color: #3D5A45; /* ä¸»è‰²èª¿ */
            --bg-color: #F2F0EB;      /* èƒŒæ™¯è‰² */
            --accent-color: #dc191f;  /* é‡‘é¡ */
            --warning-color: #CF995F; /* ç¯©é¸èˆ‡è­¦ç¤º */
            --text-main: #3E3E3E;     /* æ–‡å­—ä¸»è‰² */
            --text-sub: #8C8C8C;      /* å‰¯æ¨™é¡Œèˆ‡æ—¥æœŸ */
            --card-bg: #FFFFFF;       /* å¡ç‰‡èƒŒæ™¯ */
        }
        body { font-family: sans-serif; background-color: var(--bg-color); margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; padding-bottom: 50px; color: var(--text-main); }
        .card { background: var(--card-bg); padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); width: 100%; max-width: 450px; box-sizing: border-box; margin-bottom: 15px; }
        h2 { text-align: center; margin-top: 0; color: var(--text-main); letter-spacing: 1px; }
        .input-group { margin-bottom: 12px; }
        label { display: block; margin-bottom: 5px; color: var(--text-sub); font-size: 14px; }
        
        input { 
            width: 100%; padding: 12px; border: 1px solid #E0DED7; border-radius: 8px; font-size: 16px; 
            box-sizing: border-box; -webkit-appearance: none; appearance: none; background-color: white;
            color: var(--text-main);
        }
        input:focus { outline: none; border-color: var(--primary-color); }
        
        .category-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 10px; }
        .cat-btn { padding: 12px; border: 1px solid #E0DED7; background: #fff; border-radius: 8px; text-align: center; font-size: 15px; cursor: pointer; font-weight: 500; color: var(--text-main); transition: 0.2s; }
        .cat-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }

        .submit-btn { width: 100%; padding: 15px; background-color: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; margin-top: 10px; box-shadow: 0 4px 6px rgba(93, 115, 126, 0.2); }

        .summary-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 10px; width: 100%; max-width: 450px; }
        .summary-item { background: #fff; padding: 10px; border-radius: 10px; border-left: 4px solid var(--primary-color); box-shadow: 0 2px 4px rgba(0,0,0,0.03); }
        .summary-label { font-size: 12px; color: var(--text-sub); }
        .summary-value { font-size: 16px; font-weight: bold; color: var(--text-main); display: block; margin-top: 4px; }

        .backup-zone { display: flex; gap: 10px; margin-top: 10px; width: 100%; }
        .backup-btn { flex: 1; padding: 10px; font-size: 13px; background: #EBE9E4; border: 1px solid #D1CFC9; border-radius: 8px; cursor: pointer; color: #777; }

        .history-section { width: 100%; max-width: 450px; margin-top: 15px; }
        .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        
        .search-bar { margin-bottom: 12px; }
        .search-bar input { padding: 8px 12px; font-size: 14px; border-color: #D1CFC9; background: #fff; }

        .filter-toggle { 
            font-size: 12px; padding: 5px 10px; border-radius: 20px; border: 1px solid #D1CFC9; 
            background: #fff; cursor: pointer; transition: 0.3s; color: var(--text-sub);
        }
        .filter-toggle.active { background: var(--warning-color); color: white; border-color: var(--warning-color); }

        .history-item { background: white; padding: 12px; border-radius: 10px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .item-info .date { font-size: 11px; color: var(--text-sub); }
        .item-info .cat { font-weight: bold; color: var(--text-main); font-size: 14px; }
        .item-info .note { font-size: 13px; color: #777; }
        .item-amount { font-size: 16px; font-weight: bold; color: var(--accent-color); }
        .delete-btn { color: #E0DED7; border: none; background: none; font-size: 20px; margin-left: 10px; padding: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div class="card">
    <h2>è¨˜å¸³æœ¬</h2>
    
    <div class="input-group">
        <label>æ—¥æœŸ</label>
        <input type="date" id="date">
    </div>

    <div class="input-group">
        <label>é¸æ“‡åˆ†é¡</label>
        <div class="category-grid">
            <div class="cat-btn" onclick="selectCat('é¤è²»')">é¤è²»</div>
            <div class="cat-btn" onclick="selectCat('å…¶ä»–')">å…¶ä»–</div>
            <div class="cat-btn" onclick="selectCat('å¿…è¦æ”¯å‡º')">å¿…è¦æ”¯å‡º</div>
            <div class="cat-btn" onclick="selectCat('éå¿…è¦èŠ±è²»')">éå¿…è¦èŠ±è²»</div>
        </div>
        <input type="hidden" id="category" value="é¤è²»">
    </div>

    <div class="input-group">
        <label>é‡‘é¡</label>
        <input type="number" id="amount" inputmode="decimal" placeholder="è¼¸å…¥é‡‘é¡">
    </div>

    <div class="input-group">
        <label>å‚™è¨»</label>
        <input type="text" id="note" placeholder="å‚™è¨»ç´°é …...">
    </div>

    <button class="submit-btn" onclick="saveData()">æ–°å¢ç´€éŒ„</button>

    <div class="backup-zone">
        <button class="backup-btn" onclick="exportData()">åŒ¯å‡ºå‚™ä»½</button>
        <button class="backup-btn" onclick="document.getElementById('importFile').click()">åŒ¯å…¥å‚™ä»½</button>
        <input type="file" id="importFile" style="display:none" onchange="importData(event)">
    </div>
</div>

<div class="summary-grid" id="summaryArea">
    <div class="summary-item"><span class="summary-label">é¤è²»</span><span class="summary-value" id="sum-é¤è²»">$0</span></div>
    <div class="summary-item" style="border-left-color: #8E9AAF;"><span class="summary-label">å…¶ä»–</span><span class="summary-value" id="sum-å…¶ä»–">$0</span></div>
    <div class="summary-item" style="border-left-color: #768970;"><span class="summary-label">å¿…è¦æ”¯å‡º</span><span class="summary-value" id="sum-å¿…è¦æ”¯å‡º">$0</span></div>
    <div class="summary-item" style="border-left-color: #CF995F;"><span class="summary-label">éå¿…è¦èŠ±è²»</span><span class="summary-value" id="sum-éå¿…è¦èŠ±è²»">$0</span></div>
</div>

<div class="history-section">
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="ğŸ” æœå°‹æ—¥æœŸæˆ–å‚™è¨»..." oninput="renderList()">
    </div>

    <div class="history-header">
        <h3 style="color:var(--text-main); font-size: 16px; margin:0;">æœ€è¿‘ç´€éŒ„</h3>
        <button id="filterBtn" class="filter-toggle" onclick="toggleFilter()">ğŸ” åƒ…çœ‹éå¿…è¦èŠ±è²»</button>
    </div>
    <div id="historyList"></div>
</div>

<script>
    let records = JSON.parse(localStorage.getItem('myRecords')) || [];
    const categories = ['é¤è²»', 'å…¶ä»–', 'å¿…è¦æ”¯å‡º', 'éå¿…è¦èŠ±è²»'];
    let isFiltered = false;

    document.getElementById('date').valueAsDate = new Date();
    selectCat('é¤è²»');
    renderList();

    function selectCat(cat) {
        document.getElementById('category').value = cat;
        document.querySelectorAll('.cat-btn').forEach(b => {
            b.classList.toggle('active', b.innerText === cat);
        });
    }

    function toggleFilter() {
        isFiltered = !isFiltered;
        const btn = document.getElementById('filterBtn');
        btn.innerText = isFiltered ? "é¡¯ç¤ºå…¨éƒ¨" : "ğŸ” åƒ…çœ‹éå¿…è¦èŠ±è²»";
        btn.classList.toggle('active', isFiltered);
        renderList();
    }

    function saveData() {
        const date = document.getElementById('date').value;
        const category = document.getElementById('category').value;
        const amount = parseFloat(document.getElementById('amount').value);
        const note = document.getElementById('note').value;

        if (isNaN(amount) || amount <= 0) { alert('è«‹è¼¸å…¥é‡‘é¡ï¼'); return; }

        records.unshift({ id: Date.now(), date, category, amount, note });
        updateStorage();
        document.getElementById('amount').value = '';
        document.getElementById('note').value = '';
    }

    function deleteRecord(id) {
        if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) {
            records = records.filter(r => r.id !== id);
            updateStorage();
        }
    }

    function updateStorage() {
        localStorage.setItem('myRecords', JSON.stringify(records));
        renderList();
    }

    function exportData() {
        if (records.length === 0) { alert('ç›®å‰æ²’æœ‰è³‡æ–™å¯ä»¥åŒ¯å‡º'); return; }
        const dataStr = JSON.stringify(records, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `è¨˜å¸³å‚™ä»½_${new Date().toISOString().slice(0,10)}.json`;
        a.click();
    }

    function importData(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const imported = JSON.parse(e.target.result);
                if (confirm(`ç¢ºå®šåŒ¯å…¥ ${imported.length} ç­†è³‡æ–™å—ï¼Ÿ`)) {
                    records = imported;
                    updateStorage();
                }
            } catch (err) { alert('æª”æ¡ˆæ ¼å¼éŒ¯èª¤ï¼'); }
        };
        reader.readAsText(file);
    }

    function renderList() {
        const listDiv = document.getElementById('historyList');
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        listDiv.innerHTML = '';

        const displayRecords = records.filter(r => {
            const matchesFilter = isFiltered ? r.category === 'éå¿…è¦èŠ±è²»' : true;
            const matchesSearch = (r.date.includes(searchTerm)) || (r.note && r.note.toLowerCase().includes(searchTerm));
            return matchesFilter && matchesSearch;
        });

        const currentTotals = { 'é¤è²»': 0, 'å¿…è¦æ”¯å‡º': 0, 'éå¿…è¦èŠ±è²»': 0, 'å…¶ä»–': 0 };

        if (displayRecords.length === 0) {
            listDiv.innerHTML = '<p style="text-align:center; color:#999; font-size:14px; margin-top:20px;">æ‰¾ä¸åˆ°ç¬¦åˆçš„ç´€éŒ„</p>';
        }

        displayRecords.forEach(r => {
            if (currentTotals.hasOwnProperty(r.category)) {
                currentTotals[r.category] += parseFloat(r.amount);
            }

            const item = document.createElement('div');
            item.className = 'history-item';
            item.innerHTML = `
                <div class="item-info">
                    <div class="date">${r.date}</div>
                    <div class="cat">${r.category}</div>
                    <div class="note">${r.note || ''}</div>
                </div>
                <div style="display:flex; align-items:center;">
                    <span class="item-amount">$${parseFloat(r.amount).toLocaleString()}</span>
                    <button class="delete-btn" onclick="deleteRecord(${r.id})">Ã—</button>
                </div>`;
            listDiv.appendChild(item);
        });

        categories.forEach(cat => {
            document.getElementById(`sum-${cat}`).innerText = `$${currentTotals[cat].toLocaleString()}`;
        });
    }
</script>

</body>
</html>